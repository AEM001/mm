# GAM 模型分析报告

本文档详细说明了 `gam_enhanced_modeling.py` 脚本的执行流程、模型选择、具体细节及最终结果。

## 1. 代码执行流程

`gam_enhanced_modeling.py` 脚本的核心流程如下：

1.  **数据加载与预处理**:
    *   加载 `processed_data.csv` 文件。
    *   选取目标变量 `Y染色体浓度` 和五个标准化后的特征：`孕周_标准化`, `BMI_标准化`, `年龄_标准化`, `怀孕次数_标准化`, `生产次数_标准化`。
    *   对目标变量 `Y染色体浓度` 进行裁剪，确保其值在 (0, 1) 区间内，以符合 Fractional-Logit 模型的要求。

2.  **模型构建与训练**:
    *   脚本选用 **Fractional-Logit GAM** 模型进行分析。该模型通过 `statsmodels.gam.api.GLMGam` 实现。
    *   **模型族 (Family)**: `Binomial`，适用于处理比例型因变量。
    *   **链接函数 (Link Function)**: `Logit`，将线性预测值映射到 (0, 1) 区间。
    *   **平滑项 (Smoother)**: 对所有五个特征均使用 B-样条 (`BSplines`) 进行平滑处理，以捕捉非线性关系。每个样条的自由度（`df`）统一设置为 6。

3.  **结果评估与输出**:
    *   模型训练完成后，脚本会生成并保存以下几类关键结果到 `gam_enhanced_results_glm/` 目录：
        *   **模型摘要**: `best_model_summary_glm.txt` 包含了模型的详细统计信息，如系数、P值、AIC/BIC等。
        *   **性能指标**: `model_performance.csv` 汇总了训练集和5折交叉验证的性能指标（MAE, RMSE, R²）。
        *   **系数详情**: `model_coefficients.csv` 提供了每个样条基函数的系数及其显著性。
        *   **诊断图**: `model_diagnostics_glm.png` 包含残差图和Q-Q图，用于评估模型拟合情况。
        *   **偏依赖图**: `partial_dependence_plots_glm.png` 可视化了每个特征对目标变量的边际效应。

## 2. 模型选择与细节

### 选用的具体模型

脚本最终执行并生成结果的模型是 **Fractional-Logit GAM**。这是一个广义可加模型，专为比例型数据设计。

*   **库**: `statsmodels`
*   **类**: `GLMGam`
*   **公式**: `Y染色体浓度 ~ s(孕周) + s(BMI) + s(年龄) + s(怀孕次数) + s(生产次数)`
    *   其中 `s()` 代表一个平滑函数（在此为B-样条）。

### 模型参数细节

*   **因变量**: `Y染色体浓度` (作为比例值处理)
*   **自变量**: `孕周_标准化`, `BMI_标准化`, `年龄_标准化`, `怀孕次数_标准化`, `生产次数_标准化`
*   **平滑器**: `BSplines`
    *   **自由度 (df)**: 6 (为每个特征设置)
    *   **样条阶数 (degree)**: 3 (三次样条)

## 3. 最终结果分析

### 模型性能

| 指标               | 训练集 (In-Sample) | 5折交叉验证 (Out-of-Sample) |
| ------------------ | ------------------ | --------------------------- |
| **R²**             | 0.142              | 0.080                       |
| **伪 R²**          | 0.142              | -                           |
| **MAE**            | 0.0250             | 0.0257                      |
| **RMSE**           | 0.0313             | 0.0322                      |

**结论**: 
*   模型在训练集上解释了约 **14.2%** 的方差，但在交叉验证中平均只能解释 **8.0%** 的方差。这表明模型存在一定的 **过拟合**，其泛化能力较弱。
*   MAE 和 RMSE 在训练集和交叉验证集上表现接近，说明模型的预测误差相对稳定。

### 特征显著性

根据 `best_model_summary_glm.txt` 和 `model_coefficients.csv` 的结果：

*   模型中所有特征的 **B-样条基函数系数的 P值均大于 0.05**。

**结论**: 
*   在这个模型配置下，**没有任何一个特征显示出对 `Y染色体浓度` 有统计上显著的非线性影响**。
*   整体来看，模型的拟合效果不佳，所选特征对 `Y染色体浓度` 的解释能力非常有限。

## 4. 总结

`gam_enhanced_modeling.py` 脚本成功构建并评估了一个 Fractional-Logit GAM 模型。该模型尝试捕捉五个临床特征与Y染色体浓度之间的非线性关系。然而，从最终结果来看，模型的整体性能较弱（R² 较低），且所有特征的非线性效应均不显著。这提示我们，当前选择的特征或模型形式可能不足以解释Y染色体浓度的变化，或者需要进一步调整模型参数（如样条的自由度）或探索其他变量。
