## 2   问题2

### 2.1 BMI分组

首先观察到孕妇BMI指数和孕周呈现正相关性，因为随着孕周增加，孕妇体重会增加。为了实现较为稳定的BMI分组，考虑以孕妇达到Y染色体浓度4%的时间的BMI为分组对象。
首先需要为每个孕妇分别建立BMI-孕周的关系模型，以将两个变量合成一个。需要注意的是孕周必须满足为10-25，按照要求去除部分数据之后，仅对数据量足够的孕妇进行建模。观察到基本呈现为线性关系，所以线性拟合模型：
$B_i\left( t \right) =\alpha _i+\beta _i\times t$
其中$B_i$为第$i$个孕妇的BMI，$t$为孕周，$\alpha_i$为截距，$\beta_i$为孕周的回归系数。用最小二乘法估计系数，对于拟合效果差的可选用二次模型，但这一选择可能加大后续计算量。
问题1中已经得到了Y染色体浓度-孕周的关系模型，所以可以通过该模型计算出每个孕妇达到Y染色体浓度4%的时间。先将每个孕妇的B-t模型带入问题1模型消去B，然后取$c_Y=4\%$，解出$t_i$，同时算出预测BMI并与$t_i$配对。
之后进行分组。首先验证BMI和达标孕周的相关性，若相关性较强，可直接按照BMI进行分组。绘制散点图并计算Spearman相关系数，验证相关性较强。
使用K-means聚类方法进行分组。绘制聚类数k-组内误差平方和曲线，使用肘部法则确定k。完成聚类并将结果作为BMI的分组结果。

### 2.2 最佳时点确定

基于BMI分组的结果，确定每组的最佳时点。为了实现风险的最小化，需要时点选取尽可能早；而为了保证Y染色体浓度能够达标，需要时点选取尽可能晚。所以存在两个因素需要相互权衡，考虑将本题视为一个优化问题。
首先量化检测过晚导致的治疗窗口期缩短的风险值，直接用选取的时点量化风险：
$Risk_i=T_i$
其中$R_i$为第$i$组BMI整体的风险值，$T_i$为第$i$组BMI数据选取的最佳时点。
其次量化检测太早导致的组内Y染色体浓度不达标的损失，用组内不达标率来量化：
$Loss_i=100R_i$
其中$R_i$为第$i$组BMI整体的不达标率，乘上系数100为了将Risk和Loss基本调整到同一量级上。
接下来建立优化模型，目标是最小化潜在风险和组内不达标率：
$min F(T_i)=\lambda\times Risk(T_i)+(1-\lambda)\times Loss(R_i)$
其中$\lambda$为权衡系数，取值范围为0-1。
约束条件包括：
$Risk(T_i)=T_i$
$Loss(R_i)=100R_i$
$R_i=\frac{N_{i,\ \text{不达标}}}{N_i}\times 100\%$
$10\le T_i\le 25$
$R(T_i)\le10\%$
在12周内发现风险低，而12周以后发现风险高。所以$\lambda$基础情况取0.8（12周以后，注重尽早发现），若解得$T_i$值早于12周，可将$\lambda$取0.5再次优化，尝试提高达标率因为选取时点已经足够早。
求解建议以0.5周步长进行尝试。若复杂度较低也可缩短步长。

### 2.3 检测误差分析

因为检测过程中准确性不能保证非常完美，所以会出现Y染色体浓度测量不准的情况，并进而导致最佳时点选取的不准确。因此考虑对附件数据中的Y染色体浓度数据添加随机的误差，并重新计算最佳时点，分析结果的稳定性。
对于BMI分组结果中每一组的所有样本的Y染色体浓度数据，分别添加服从正态分布的随机误差：
$c_{扰动}=c_{原始}\times (1+0.05r)$
其中r为[-1,1]区间内的均匀随机数。
不对BMI重新进行分组，直接使用2.2中的优化模型进行计算。重复一定次数（建议为例如1000次），得到最终结果时点的分布，计算均值和标准差。与扰动前结果进行对比，从而分析结果的稳健性。

## 2'   问题2，另解

### 2'.1 BMI分组

对于附件数据中所有男胎孕妇，若连续几次检测均呈现出Y染色体浓度不足4%，则该孕妇数据剔除，不参与下面的分析。
对于每名孕妇，选取其第一次检测Y浓度超过4%的数据，形成数据结构：孕妇-BMI-最早达标孕周。特别的，如果孕妇所有检测中均呈现Y浓度超过4%，则取第一次检测数据。
为确保BMI分组区间互不重叠，采用仅基于BMI的一维K-means进行分组：对BMI做Z-score标准化后聚类，随后按聚类中心从小到大排序，并用相邻中心点的中点作为区间边界，从而得到严格互斥的BMI区间。孕周变量仅用于组内最佳时点的统计与可视化，不参与聚类。聚类数k通过肘部法则与轮廓系数综合确定。

### 2'.2 最佳NIPT时点确定

对于每一组内最佳时点确定，需要分情况讨论。题目强调12周以内是低风险的区间，而超过12周就会存在高风险。因此会在满足大多数孕妇能够达标的前提下尽可能将时点设定在12周内。
设定最佳时点的一般方法是：对于一个分组中所有最早达标孕周，计算其10%分位数$t_{10}$。若$t_{10}$略大于12周，则计算$t_{20}$，允许在至少80%孕妇满足条件的情况下将最佳时点提前到12周以降低风险。否则直接将$t_{10}$设为本组最佳时点。

### 2'.3 检测误差分析

误差主要出现在Y浓度测定上。所以对所有Y浓度数据，随机添加±5%的随机误差，重新分组并计算最佳NIPT时点。重复多次，统计最终结果分布情况。将分布情况与原结果比对，分析原结果的稳健性。
同时也需要分析BMI分组的稳健性。对BMI数据也添加随机误差，重新分组并计算最佳NIPT时点，比对结果分析稳健性。
